# ローマ字入力辞書 生成設計（Typing Software）

本ドキュメントでは、ローマ字入力判定用辞書の設計方針と、辞書生成ツールの考え方をまとめる。

---

## 1. 設計の目的

ローマ字入力の正解判定ロジックをコードに埋め込まず、外部辞書として生成・管理する。目的は以下のとおり。

- 正解入力（canonical）と許容入力（variants）を明確に分離
- 判定ロジックの肥大化防止と保守性向上
- 入力方式の違いへの柔軟対応
- 教育的に一貫した入力ルールの提示

---

## 2. source.csv の役割

### 2.1 構成

```csv
display,kana,romaji
```

| 列名    | 内容                                 |
| ------- | ------------------------------------ |
| display | 画面に表示する文字（漢字・かな等）   |
| kana    | 読み（基本はひらがな）               |
| romaji  | 正解として教えるローマ字入力（canonical） |

### 2.2 記述原則

- `romaji` 列には基準となる 1 つの canonical のみを書く。
- 入力の揺らぎ（例: si / shi）は書かない。揺らぎ展開は生成ツールの責務。

---

## 3. canonical と variants

### 3.1 canonical（正規形）

同じ読みを表す複数の入力方法の中で、教材として基準とする 1 つの表記。授業・教材・説明で「正解」として示し、ログ分析やフィードバックの基準点とする。

例: `canonical: "honnyaku"`

### 3.2 variants（許容入力）

正解として許容する入力の集合。以下を含む。

- ローマ字表記の揺らぎ（例: shi / si）
- 撥音・促音・拗音に関する入力差

例: `romaji: ["honnyaku"]`

※ 教育方針により、曖昧さを生む入力は除外する場合がある。

---

## 4. 撥音「ん」の入力方針（重要）

統一ルールを以下に定める。

### 4.1 基本ルール

| 条件                     | 入力 |
| ------------------------ | ---- |
| 文末の「ん」             | nn   |
| 母音・や行（や/ゆ/よ）の前 | nn   |
| それ以外（子音の前）     | n    |

### 4.2 採用理由

- `n + ya` がにゃ行と混線しやすい
- 入力の曖昧さを減らし誤入力を防ぐ
- 規則として説明しやすく教育的に一貫する

### 4.3 例

| 読み     | canonical   |
| -------- | ----------- |
| しゃしん | shashinn    |
| ほんやく | honnyaku    |
| しんかんせん | shinkansenn |

---

## 5. 辞書生成ツールの責務

- kana（ひらがな）をもとにローマ字候補を生成
- 拗音・促音・撥音を考慮した variant 展開
- 教育方針に反する入力の除外
- canonical を必ず variants に含める

typing ソフト本体は辞書を参照して判定するのみで、ローマ字変換ロジックを持たない。

---

## 6. 本設計のメリット

- 判定ロジックをシンプルに保てる
- 入力ルールを後から変更しやすい
- 教育方針をコードではなくデータで表現できる
- 生成 AI での source.csv 作成とも相性が良い

---

## 7. まとめ

本設計は「正解をコードで作らない」「入力を許すのではなく、入力を教える」という思想に基づく。辞書生成を独立させることで、タイピングソフト本体・教材・運用のすべてで保守性と一貫性を高める。