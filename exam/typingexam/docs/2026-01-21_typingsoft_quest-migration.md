# Typingソフト改修ログ（2026-01-21）

## 概要

本日は、JavaScript製タイピングソフトにおいて  
**正解判定ロジックを「quest.js 辞書方式」に一本化する改修**を進めた。

従来の「かな → ローマ字生成」に依存した複雑な判定を段階的に廃止し、
最小変更・動作確認を重視したリファクタリングを行った。

---

## 背景・目的

### 従来の課題
- 正解を内部ロジックで生成しており、挙動が複雑
- ヘボン式／訓令式／例外処理がコード側に散在
- デバッグ・問題追加のコストが高い

### 今回のゴール
- **正解は quest.js の romaji[] のみで定義**
- program.js は「辞書を参照して判定するだけ」にする
- 段階的に旧ロジック（kana / roma / preInputView）を削除可能な状態にする

---

## 実施内容

### 1. quest.js の整理（辞書方式）

- 問題定義を以下の形式に統一

```js
{
  display: "コーヒー",
  romaji: ["KO-HI-", "KOHII"]
}

複数の入力パターンは romaji[] で吸収

kana は暫定的に残しているが、判定には不使用

2. program.js の判定ロジック簡素化

以下の 3段階ロジックに整理：

入力1文字を buf に追加

romaji[] のいずれかの prefix か？

NO → ミス

YES → 続行

完全一致 → 1問クリア → 次の問題へ

const nextBuf = buf + ch;

if (!isPrefixOk(nextBuf, expectedList)) {
  // ミス処理
} else {
  buf = nextBuf;
  if (isExactOk(buf, expectedList)) {
    NextWordView();
  }
}

3. ガイドキー（黄色表示）の復活

辞書方式移行により一度消えていた「正しいキーの黄色表示」を復活

最小変更として、正しい入力時に押したキーを黄色表示

changeColor(ch);


次段階として「次に押すべきキー」を表示する余地を残した

4. 表示崩れ（中央寄せ）の修正

.msgStr の幅を取得し、親要素基準で中央寄せ

CSSとJSの責務を分離して安定化

5. Git / GitHub 周りの整理

不要な feature ブランチを削除

作業ブランチを main に集約

GitHub Pages の挙動不安定問題を以下で解消：

ディレクトリ直下に index.html を配置

URL末尾 / を正とする

相対パス（./）を使用

現在の状態まとめ

✅ 辞書ベース判定が正常に動作

✅ ガイドキー（黄色・赤）が表示される

✅ GitHub Pages で安定してアクセス可能

⚠ 旧 kana / roma / preInputView は今後削除予定

次回以降のTODO

 ガイドキーを「次に押すべきキー」に進化させる

 preInputView を表示専用 or 削除

 kana / roma / kanaroma.js の完全撤去

 quest.js の問題数拡充（100問規模）

所感（メモ）

辞書方式に切り替えたことで、設計の見通しが一気に良くなった

「最小変更 → 動作確認 → 次へ」の流れが有効

教育用途としても、判定ロジックが説明しやすくなった
