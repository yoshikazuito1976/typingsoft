# かな一致方式（WanaKana利用）の検証ログ

## 背景

本プロジェクトでは、ローマ字入力による日本語タイピング学習を目的としている。
当初は「ローマ字辞書方式（romaji → 正誤判定）」を採用していたが、

- romaji の揺れ（nn / n多打 / xtu / ltu / 訓令式）
- 辞書の肥大化
- 教育的に「許したい揺れ」「許したくない揺れ」の制御

といった課題が顕在化した。

その解決策として、
gi
> **入力 → かな変換 → kana 一致判定**

という方式を検証するため、WanaKana を用いた実装実験を行った。

---

## 実験内容

- WanaKana（IME モード）を利用し、ローマ字入力を逐次かな変換
- 変換結果と問題側の `kana` を prefix / 完全一致で判定
- 辞書側の romaji 定義を削減し、kana 中心に寄せる

---

## 発生した主な問題

### 1. 入力途中ローマ字の扱い

- `g` / `k` / `ny` など、**未確定ローマ字**の段階で
  - `toKana()` がかなに変換しない、または
  - 一部だけ変換される
- その結果、1キー入力ごとの即時判定では常にミスになりやすい

### 2. 「ん（n）」の確定タイミング問題

- WanaKana は単独の `n` を「ん」に確定する挙動を持つ
- 例：`nyuugaku`（にゅうがく）の入力途中で
  - `n` → `ん` と確定してしまい、以降がすべて不一致になる
- n多打（nn / nnn）や「n + 子音」の教育的扱いとの相性が難しい

### 3. 1キーごとの正誤判定との不整合

- 現行システムは「1文字入力ごとに正誤を判定」する設計
- かな一致方式では
  - 「確定かなが増えた瞬間」だけを評価した方が自然
- この2つの設計思想が衝突した

---

## 結論（現時点）

- **かな一致方式は理論的には有効**
- しかし、現行の「即時キー判定型 UI」と組み合わせるには
  - かな確定単位での進行管理
  - n の扱いを含む独自の状態機械
が必要になり、実装コストが高い

そのため現時点では：

- 本方式は **experimental ブランチで検証継続**
- main 系統は **ローマ字辞書方式を継続**
- 辞書肥大化は「自動生成・ルール化」で対応する

という判断とする。

---

## 今後の展望

- かな一致方式を「別モード」として実装する可能性
- 教育目的に応じた入力評価レベルの切り替え
- n・促音・拗音を状態機械として扱う設計の再検討

本ドキュメントは、設計判断の経緯を残すための記録である。
